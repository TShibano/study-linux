# Chapter03 シェルを使う

本章では，OS(Linuxカーネル)とユーザを繋ぐシェルについて紹介し，実際にコマンドを入力し，Linuxで処理を実行してもらう．
3.1では，カーネルとシェルの役割について説明する．
3.2では，実際にシェルに触れる．
3.3では，これから実際に操作をしていくシェルでの作業効率向上のための便利機能について簡単に紹介する．

早くコマンドを打ちたい方もいると思うので，先に簡単なコマンドを入力してみる．
まず，Linux環境にログインする．
GUI環境でログインした場合，アプリケーション一覧から端末(ターミナル)を開く．

`whoami`と入力する．
下記のような画面になる．

```
$ whoami    # $は初めから入力されている
penguin  (<- 左の文字は各個人の環境によって変化する)
```

`whoami`は，今操作しているユーザを表示する．

今後Linuxを操作するときは，今回のようにコマンドを使って操作する．

## 3.1 Linuxカーネルとシェル
まずはLinuxが内部でどのように動いてコマンドを実行しているのかを説明する

Linuxは次のような順番で処理を行う．

1. キーボードから入力された`whoami`という文字列を受け取る
2. `whoami`という名前のコマンドを探す
3. 見つかったコマンドを実行する
4. 実行結果を画面に出力する

このうち，3のコマンドを実行する部分は，Linuxの本体である**Linuxカーネル**が行う．

カーネルは，OSの中核となる部分で，ハードウェア(e.g. CPU，メモリ)の管理やコマンド実行を処理するプロセス管理を行う．

そして，カーネルとユーザを橋渡しするのがシェルである．
シェルはカーネルのインターフェースとなる．
シェルはユーザが入力したコマンドを受け取り，コマンドを探し出し，コマンドを実行するようにLinuxカーネルに依頼する．
その後，Linuxカーネルがコマンドの実行を終了すると，シェルはその結果を受け取りユーザ画面に出力する．

カーネルとシェルが分離されている主な理由は下記の通りである．

- シェルだけを自分好みのものにカスタマイズできる
- Linux以外のOSを利用する際も，シェルが移植されていれば同様の操作ができる
- シェルがクラッシュしても，カーネルへの影響を最小限に抑えられる

## 3.2 Shellを触る

では，実際にコマンドを打ち込んでみよう．
このコマンドは現在の日時を表示するコマンドである．
```bash
date
```

このコマンドは現在のディレクトリに存在するファイル・ディレクトリを表示します．
```bash
ls
```

このコマンドは環境変数`$SHELL`の値を表示する．
つまり，現在のシェルのパスを表示する．
```bash
echo $SHELL
```
次は少し複雑なコマンドを入力する
```bash
ps aux | grep $(whoami)
```

これはシェルの機能を組み合わせて，「現在実行中のプロセスのうち，このコマンドを実行しているユーザが実行しているプロセス一覧を表示する」コマンドである．
このコマンドの説明は下記の通りである．

1. `ps aux`で現在実行中のプロセスを表示する
2. `|`(パイプ)を用いて，前の実行結果を次のコマンドに渡す
3. `grep`で与えられた文字列`$(whoami)`=実行ユーザ名を含む行を抽出する
    - `$(whoami)`には，このコマンドを実行しているユーザ名が入る

今すぐこの内容を理解するのは難しいかもしれないが，この資料を一通り学習すると意味が分かるようになる．

## 3.3 シェルの便利機能

これからキーボードでコマンドを入力し，シェルで様々なコマンドを実行する．
ここではコマンドを実行する上での便利機能を紹介する．

### コントロールキーを用いた操作

シェルの操作には，さまざまなキーボードショートカットが用意されている．
特に，Controlキーと他のキーを組み合わせて使うショートカットが多い．
これから，Controlキーを使ったショートカットキーを紹介するが，
キー入力`C-f`とはControlキーを押しながらfキーを押すことである．

| キー入力 | 意味 |
| --- | --- |
| `C-f` | 1文字前方に移動する |
| `C-b` | 1文字後方に移動する |
| `C-a` | 行頭に移動する |
| `C-e` | 行末に移動する |
| `C-h` | カーソル位置の後方1文字を削除する(Backspaceキーと同じ) |
| `C-d` | カーソル位置の前方1文字を削除する(Deleteキーと同じ) |
| `C-k` | カーソル位置から行末まで削除する |
| `C-u` | カーソル位置から行頭まで削除する |
| `C-p` | 直前のコマンドを表示する(上矢印キーと同じ) |
| `C-n` | 次のコマンドを表示する(下矢印キーと同じ) |
| `C-r` | インクリメンタル検索を開始する |
| `C-c` | 現在のコマンドを強制終了する |
| `C-l` | 画面をクリアする |

### 補完機能

シェルには補完機能が備わっている．
途中までコマンドを入力し，Tabキーを押すことで候補がいくつか表示され，Enterキーで決定できる．
補完機能を使うことで，間違えずにコマンドを入力できるため，積極的に活用するとよい．

```bash
ech   # ここでTabキーを押す
echo  # echoと補完される
```

### コマンド履歴

過去に利用したコマンドを再度利用したい場合，履歴を使うことができる．
`C-p`または上矢印キーを押すことで直前のコマンド履歴を表示できる．
また，`C-r`を押すことで「インクリメンタル検索」という特殊な検索モードになる．
このモードでは1文字入力するごとに履歴を検索できる．

### トラブル時

何らかのコマンドを実行してシェルからの応答がなくなった場合，`C-c`を押すことで強制終了できる．

## 補足: ターミナルとシェル

ターミナルとシェルは明確に区別される．ターミナルはユーザがテキストベースの入力と出力を行うためのインターフェースを提供する．一方，シェルはユーザからのコマンドを受け取り，カーネルに命令を送る役割を持つ．つまり，ターミナルはユーザとコンピュータとの間のコミュニケーションチャネルであり，シェルはそのコミュニケーションを解釈し，適切な操作を行う役割を持つ．