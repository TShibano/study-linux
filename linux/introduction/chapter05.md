# Chapter05 ファイル・ディレクトリ

本章では，Linuxで最もよく使うことになる，ファイル・ディレクトリ操作に関するコマンドを紹介します．5.1ではファイル・ディレクトリとパスについて説明します．5.2では，よく使われるファイル・ディレクトリ操作のコマンドを紹介します．5.3ではファイルの権限を表すパーミッションについて説明します．5.4ではファイルをまとめるアーカイブとファイルサイズを小さくする圧縮の方法を紹介します．5.5ではファイルを別のサーバに転送する方法を紹介します．

## 5.1 ファイル・ディレクトリとパス

### ファイル・ディレクトリ

コンピュータでは、情報はファイルとして保存されます。ファイルにはテキストファイルや音声ファイル，画像ファイルなどがあります．ディレクトリはファイルをまとめるものです．またディレクトリ自身もまとめることができます．Windowsではフォルダと呼ばれます．

### 特別なディレクトリ

- `.` : カレントディレクトリ．現在いるディレクトリです．
- `..` : 親ディレクトリ．現在いるディレクトリの1階層上のディレクトリです．
- `~` : ホームディレクトリ．ユーザの作業開始位置となるディレクトリのことです．ログイン直後のユーザはホームディレクトリにいます．ユーザによってホームディレクトリの位置は異なります．
- `/` : ルートディレクトリ ．最上位のディレクトリであり，Linuxでは，すべてのディレクトリやファイルを上に遡ると，ルートディレクトリに辿り着きます．

### 絶対パスと相対パス

ファイルやディレクトリの位置を示す方法として，絶対パス (absolute path) と相対パス (relative path) があります．それぞれの説明とメリットは下記になります．

- **絶対パス**
    - ファイルやディレクトリの位置をルートディレクトリから指定する方法です．
    - 複雑な階層でも目的地を間違えにくいという利点があります．
- **相対パス**
    - 現在作業しているファイルやディレクトリを起点にして目的地までの経路を示す方法です．
    - スタート地点が異なると、相対パスも異なります。つまり、現在地に依存します。
    - ルートディレクトリが移動した場合でも、相対パスは修正不要というメリットがあります．他の人に

## 5.2 ファイル操作のコマンド

本節では、Linuxでよく使われるファイル操作のコマンドを紹介します．実際にコマンドを入力してみて結果を確認してみてください．

コマンドの紹介方法は，「書式」，「オプション」，「例」の順番で紹介します．書式はコマンドの書き方を表します．オプションはコマンドにつけることでコマンドの動作を変えることができます．

各コマンドを実行するために，以下のコマンドを実行してください．

```bash
cd ~
mkdir chapter5
cd ~/chapter5
```

### ファイルやディレクトリを参照する

書式

```bash
ls [オプション] <ファイル・ディレクトリのパス>
```

オプション

- `-a` : `.` 始まる隠しファイル等も全て (all) 表示します
- `-l` : 長い形式 (long) で出力します

例

```bash
ls -al     # 自分が今いるディレクトリにあるすべてのファイル・ディレクトリを長い形式で表示する
ls -al ~/    # 自身のホームディレクトリにあるすべてのファイル・ディレクトリを長い形式で表示する
ls -a -l ~/    # 上記と同じ．オプションは基本的に順不同，かつまとめても良い．(コマンドによっては細かくルールが決まっているものもあり)
ls /etc/*.conf    # /etc/ディレクトリにある<任意の文字列>.confファイルを表示する
ls /etc/???.????    # /etc/ディレクトリにある，任意の3文字と . と 任意の4文字のファイルを表示する
```

例で紹介したように，表示するファイル・ディレクトリはワイルドカードを使って絞り込むことができます．主なワイルドカードは下記になります．

- `*` : 任意の文字列を表す
- `?` : 何らかの1文字を表す

### 現在のディレクトリを表示する

書式

```bash
pwd
```

### ディレクトリを変更する

書式

```bash
cd <ディレクトリ名>
```

例

```bash
cd ~    # ホームディレクトリに移動
cd      # ディレクトリ名を省略すると，ホームディレクトリに移動する
```

### ディレクトリを作成する

書式

```bash
mkdir [オプション] <ディレクトリ名>
```

オプション

- `-p` : 指定されたディレクトリの上位ディレクトリも作成する

例

```bash
cd ~/chapter5
mkdir -p dir_x/dir_y/
ls
ls dir_x
```

### ファイル・ディレクトリをコピーする

書式

```bash
cp [オプション] <コピー元> <コピー先>
```

オプション

- `-r` : ディレクトリをコピーする

例

```bash
cd ~/chapter5   # 下準備1
cp /etc/hosts ~/chapter5    # /etc/hosts というファイルをホームディレクトリにコピーする
ls      # hostsファイルがコピーされているかの確認
touch file1
cp file1 file2    # /etc/hosts というファイルを，ホームディレクトリに， hosts_copy という名前でコピーする
ls
```

```bash
cd ~/chapter5
mkdir dir1     # 下準備
cp dir1/ dir2/    # エラーが出る
cp -r dir1/ dir2/    # dir1 ディレクトリを dir2 ディレクトリという名前でコピーする
ls          # newdir ディレクトリ内に olddir ディレクトリがある
```

### ファイル・ディレクトリを移動する

ファイルやディレクトリを別のディレクトリに移動することができる．また，ファイル・ディレクトリの名前を変更することもできる．

書式

```bash
mv [オプション] <移動元> <移動先>
```

オプション

- `-f` : 強制的に実行する．

例

```bash
cd ~/chapter5
ls
mv file2 file2-1    # file2 を file2-1 という名前に変更する
ls
```

```bash
cd ~/chapter5
ls
mv dir2/ dir2-1/    # newdir を newdir2という名前に変更する
```

### ファイル・ディレクトリを削除する

書式

```bash
rm [オプション] <ファイル名>
```

オプション

- `-f` : 強制的に削除する．
- `-r` : ディレクトリを削除する．ディレクトリの中にあるファイル・ディレクトリも削除する
    - ただし，このオプションは慎重に使用してください．そして可能ならば後述する `rmdir` コマンドを利用してください．

例

```bash
cd ~/chapter5
rm file2-1
rm dir2-1    # エラーが出ます
rm -r dir2-1     # 削除できます
```

ディレクトリを削除したい場合，`rm -r` の代わりに， `rmdir` コマンドを使うことをお勧めします． `rmdir`コマンドは，空のディレクトリを削除するコマンドです．Linuxでは一度削除したファイルやディレクトリを復旧することは出来ません (Windowsのようなゴミ箱はありません) ．ですので，間違ったディレクトリを消さないためにも， `rmdir` コマンドを使うと良いでしょう．

書式

```bash
rmdir [オプション] <ディレクトリ名>
```

オプション

- `-p` : 指定した階層までのディレクトリを一括で削除する．ただし，削除対象となるディレクトリは空である必要

### ファイルの内容を表示する

ファイルの内容を表示する方法はいくつかあります．

`cat` はファイルの内容を全て表示します．

書式

```bash
cat [オプション] <ファイル名>
```

オプション

- `-n` : 行番号も合わせて表示する

例

```bash
cd ~/chapter5
printf "%s\n" {a..z} > alphabets    # 下準備
cat -n alphabets
```

`head` や `tail` コマンドは先頭もしくは末尾の数行を表示します．

書式

```bash
head [オプション] <ファイル名>
tail [オプション] <ファイル名>
```

オプション

- `-n 数字` : 先頭もしくは末尾から指定した数字分の行を出力します
- `-f` : (`tail`のみ)ファイルの変更をリアルタイムでモニターする．ログファイルの監視などによく使われる．

例

```bash
cd ~/chapter5
head -n 5 alphabets
tail -n 3 alphabets
```

### ファイルを検索する

ファイルがどこのディレクトリに存在するかを検索できます．

書式

```bash
find <パス> -name <ファイル名>
```

例

```bash
find ~ -name file1
```

### コマンドのパスを検索する

コマンドの実体はプログラムです．プログラムもファイルの一種であり，プログラム用のディレクトリに配置されています (もちろん，自分で好きな場所に配置することも可能です) ．しかしながら，基本的なコマンドを実行する時，そのプログラムがどのディレクトリに属するかを意識する必要はありません． `PATH` という環境変数に，プログラムが配置されているディレクトリを設定しているからです．インターネットでプログラミング言語などをインストールしたときに，「パスを通します」と書かれているのは，このことになります．

書式

```bash
which <コマンド名>
```

例

```bash
which ls
which cat
```

また， `PATH` 環境変数に含まれているディレクトリは以下のコマンドで確認できます．

```bash
echo $PATH
```

## 5.3 パーミッション

Linuxではファイルやディレクトリに関する権限 (パーミッション) が重要な役割を果たします．これにはファイルの読み取り，書き込み，実行の権限が含まれます．これらのパーミッションは，所有者（owner) ，グループ (group) ，その他のユーザー (other) の3つのカテゴリに分けられます。そして，権限は，読み取り (r) ・書き込み (w) ・実行 (x) の3つからなります．

ファイルのパーミッションや所有者，グループなどを確認する方法として， `ls -l` があります．

例えば，私の環境では以下のような結果が得られます．

```
$ ls -l /bin/ls
-rwxr-xr-x  1 root  wheel 187120  12 31 2020  /bin/ls
```

この結果の例として，見方を説明します．ファイルのパーミションは， `rwxr-xr-x` で表され，その後の `root` や `wheel` が所有者，グループを表しています．(先頭の `-` は，ファイルかディレクトリかの指標です．)

この `rwxr-xr-x` パーミッションは以下のような意味になります．

|  | 読み込み | 書き込み | 実行 |
| --- | --- | --- | --- |
| 所有者 (root) | ◯ | ◯ | ◯ |
| グループ (wheel) | ◯ | × | ◯ |
| その他のユーザ | ◯ | × | ◯ |

パーミッションの変更には， `chmod` コマンドが用いられます．

```bash
chmod <設定方法> <ファイル名>
```

設定方法には，シンボルモードと数値モードがあります．

- シンボルモード: `u+x` のように文字で表す．
    - `[ugoa][+-=][rwx]` で書く (誰に，どうする，何の権限を)
    - `[ugoa]` : 所有者，グループ，その他，全員　に対して
    - `[+-=]` : 権限を付与する，禁止する，指定した権限と等しくする
    - `[rwx]` : 読み込み，書き込み，実行権限を
- 数値モード: `755` のように8進数の3桁の数値で表す
    - 1番大きい桁が所有者，次にグループ，最後がその他の権限を示す
    - 各桁は，8進数であり，4 (読み込み) + 2 (書き込み) + 1 (実行) の有無で表される．
    - 例えば， `7` ならすべての権限があり， `5` (4+1)では，読み込みと実行権限がある．

ファイルの所有者やグループを変えたい時には，`chown` や `chgrp` コマンドを使います．

```bash
chown <ユーザ名> <ファイル・ディレクトリ名>
chgrp <グループ名> <ファイル・ディレクトリ名>
chown <ユーザ名>:<グループ名> <ファイル・ディレクトリ名>   # 同時に変更
```

## 5.4 アーカイブと圧縮

プログラムなどを作成している時多くファイルを扱いますが，アーカイブと圧縮は非常に重要です。これらの機能を使用することで，ファイルやディレクトリを効率的に保存，転送，またはバックアップすることができます．

アーカイブは複数のファイルやディレクトリを一つのファイルにまとめることです．圧縮はファイルのサイズを小さくすることです．この2つを作業を行なって，複数のファイルを一つにまとめてからそのサイズを小さくすることが一般的です．

以下，Linuxでよく使われるアーカイブと圧縮のコマンドをいくつか紹介します．

ファイルを圧縮したい時， `gzip` コマンドを使用します．

```bash
gzip <ファイル名>    # <ファイル名>.gz というファイルが出力されます．
```

ディレクトリを圧縮したい時， `tar` コマンドを使用してアーカイブファイルを作ってから， `gzip` をします．多くの場合， `tar` コマンドのオプションをつけて，1行で処理します．

```bash
tar zcvf <作成するファイル名> <対象のファイル・ディレクトリ名>
```

- `z` : gzip方式を指定
- `c` : 新しくアーカイブファイルを作成する
- `x` : 圧縮ファイルからファイルを取り出す
- `v` : 圧縮・展開するファイル名を表示する
- `f` : アーカイブファイル名を指定する

圧縮されたファイルを展開した時，下記のコマンドを用います．

```bash
tar zxvf <展開したいファイル名>
```

## 5.5 ファイルの転送

異なるコンピュータ間でのファイルのやり取りの方法はいくつかあります．最近ではクラウド機能を活用してファイルのやり取りがされていますが，コマンドを使ってファイルを転送することもできます．ファイル転送には複数の通信方式があります．ここでは基本的な通信方式を紹介します．実際に異なるコンピュータ間で通信する場合，それぞれの環境・用途に合わせて選択してください．

- FTP (File Transfer Protocol) : FTPは，ネットワークを通じてファイルを転送するための最初のプロトコルです。暗号化されていないので，注意が必要です．
- SCP (Secure Copy): SCPは，SSH(Secure Shell)プロトコルを使用して暗号化されたネットワーク接続を通じてファイルを転送します．Unix/Linux間でしか使用できませんが，高速です．

SCPコマンドは以下のように成政

書式

```bash
scp [オプション] <コピー元パス> <コピー先パス>
```

オプション

- `-i` : 鍵ファイルを指定する
- `-p` : ポート番号を指定する．
- `-r` : ディレクトリごと再起的にコピーする

パスの指定方法

```bash
<ユーザ名>@<サーバのホスト名>:<パス>
```

ローカルPC場合、`<ユーザ名>@<サーバのホスト名>:`は省略出来ます．

## 補足 文字コード

文字コードは，コンピュータが文字を識別，表示，処理するための一連の規則です．すべての文字や記号 (絵文字) は、ユニークな数値コードにマッピングされます．最もよく知られている文字コードには，ASCII（American Standard Code for Information Interchange），Unicode，Shift-JISなどがあります．日本語を使用する環境では，Unicodeの一つであるUTF-8やShift-JISがよく使われています．文字コードは，テキストファイルを作成，読み取り，編集する際に特に重要で，間違った文字コードを使用すると，テキストが正しく表示されない，いわゆる文字化けが起こります．ファイルを開いて文字化けが起きた場合，ファイルを開くアプリの文字コード設定を見直すと良いでしょう．

## 補足 バイナリ

バイナリは2進数を指す言葉です．コンピュータ内部では全てのデータが0と1のバイナリ形式で扱われます．特にバイナリファイルは，テキストファイルとは異なり，コンピュータが読むことに特化しており，人間が直接読むことを意図していないファイルです．実行可能ファイル、画像ファイル、音声ファイルなどがこれに該当します．例えば，Vimを使って画像ファイルを読み込むとよく分からない画面が表示されると思います．バイナリ形式のファイルは特殊なソフトウェアなしには読み取ることができず，また間違った操作をするとデータの破損の原因となるため，注意が必要です．