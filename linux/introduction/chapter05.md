# Chapter05 ファイル・ディレクトリ

本章では，Linuxで最もよく使うことになるファイル・ディレクトリ操作に関するコマンドを紹介する．5.1ではファイル・ディレクトリとパスについて説明する．5.2ではよく使われるファイル・ディレクトリ操作のコマンドを紹介する．5.3ではファイルの権限を表すパーミッションについて説明する．5.4ではファイルをまとめるアーカイブとファイルサイズを小さくする圧縮の方法を紹介する．5.5ではファイルを別のサーバに転送する方法を紹介する．

## 5.1 ファイル・ディレクトリとパス

### ファイル・ディレクトリ

コンピュータでは情報はファイルとして保存される．ファイルにはテキストファイルや音声ファイル，画像ファイルなどがある．ディレクトリはファイルをまとめるものである．またディレクトリ自身もまとめることができる．Windowsではフォルダと呼ばれる．

### 特別なディレクトリ

- `.` : カレントディレクトリ．現在いるディレクトリを指す．
- `..` : 親ディレクトリ．現在いるディレクトリの1階層上のディレクトリを指す．
- `~` : ホームディレクトリ．ユーザの作業開始位置となるディレクトリである．ログイン直後のユーザはホームディレクトリにいる．ユーザによってホームディレクトリの位置は異なる．
- `/` : ルートディレクトリ．最上位のディレクトリであり，Linuxではすべてのディレクトリやファイルを上に遡るとルートディレクトリに辿り着く．

### 絶対パスと相対パス

ファイルやディレクトリの位置を示す方法として絶対パス(absolute path)と相対パス(relative path)がある．それぞれの説明とメリットは下記の通りである．

- 絶対パス
    - ファイルやディレクトリの位置をルートディレクトリから指定する方法である．
    - 複雑な階層でも目的地を間違えにくい利点がある．
- 相対パス
    - 現在作業しているファイルやディレクトリを起点にして目的地までの経路を示す方法である．
    - スタート地点が異なると相対パスも異なる．つまり現在地に依存する．
    - ルートディレクトリが移動した場合でも相対パスは修正不要というメリットがある．

## 5.2 ファイル操作のコマンド

本節では，Linuxでよく使われるファイル操作のコマンドを紹介する．実際にコマンドを入力して結果を確認するとよい．

コマンドの紹介方法は「書式」「オプション」「例」の順で紹介する．書式はコマンドの書き方を表す．オプションはコマンドにつけることでコマンドの動作を変えることができる．

各コマンドを実行するために，以下のコマンドを実行する．

```bash
cd ~
mkdir chapter5
cd ~/chapter5
```

### ファイルやディレクトリを参照する

書式

```bash
ls [オプション] <ファイル・ディレクトリのパス>
```

オプション

- `-a` : `.`で始まる隠しファイル等もすべて(all)表示する
- `-l` : 長い形式(long)で出力する

例

```bash
ls -al     # 現在のディレクトリにあるすべてのファイル・ディレクトリを長い形式で表示する
ls -al ~/    # ホームディレクトリにあるすべてのファイル・ディレクトリを長い形式で表示する
ls -a -l ~/    # 上記と同じ．オプションは順不同，まとめてもよい．
ls /etc/*.conf    # /etcディレクトリにある任意の文字列.confファイルを表示する
ls /etc/???.????    # /etcディレクトリにある任意の3文字と.と任意の4文字のファイルを表示する
```

表示するファイル・ディレクトリはワイルドカードで絞り込むことができる．主なワイルドカードは下記の通りである．

- `*` : 任意の文字列を表す
- `?` : 任意の1文字を表す

### 現在のディレクトリを表示する

書式

```bash
pwd
```

### ディレクトリを変更する

書式

```bash
cd <ディレクトリ名>
```

例

```bash
cd ~    # ホームディレクトリに移動
cd      # ディレクトリ名を省略するとホームディレクトリに移動
```

### ディレクトリを作成する

書式

```bash
mkdir [オプション] <ディレクトリ名>
```

オプション

- `-p` : 指定されたディレクトリの上位ディレクトリも作成する

例

```bash
cd ~/chapter5
mkdir -p dir_x/dir_y/
ls
ls dir_x
```

### ファイル・ディレクトリをコピーする

書式

```bash
cp [オプション] <コピー元> <コピー先>
```

オプション

- `-r` : ディレクトリをコピーする

例

```bash
cd ~/chapter5   # 下準備
cp /etc/hosts ~/chapter5    # /etc/hostsファイルをホームディレクトリにコピーする
ls      # hostsファイルがコピーされているか確認
```

```bash
touch file1
cp file1 file2    # file1をfile2という名前でコピーする
ls
```

```bash
cd ~/chapter5
mkdir dir1     # 下準備
cp dir1/ dir2/    # エラーが出る
cp -r dir1/ dir2/    # dir1ディレクトリをdir2ディレクトリという名前でコピーする
ls          # dir2ディレクトリ内にdir1ディレクトリがある
```

### ファイル・ディレクトリを移動する

ファイルやディレクトリを別のディレクトリに移動できる．また，ファイル・ディレクトリの名前を変更することもできる．

書式

```bash
mv [オプション] <移動元> <移動先>
```

オプション

- `-f` : 強制的に実行する

例

```bash
cd ~/chapter5
ls
mv file2 file2-1    # file2をfile2-1という名前に変更する
ls
```

```bash
cd ~/chapter5
ls
mv dir2/ dir2-1/    # dir2をdir2-1という名前に変更する
```

### ファイル・ディレクトリを削除する

書式

```bash
rm [オプション] <ファイル名>
```

オプション

- `-f` : 強制的に削除する
- `-r` : ディレクトリを削除する．ディレクトリ内のファイル・ディレクトリも削除する
    - このオプションは慎重に使用する．可能なら後述の`rmdir`コマンドを利用する．

例

```bash
cd ~/chapter5
rm file2-1
rm dir2-1    # エラーが出る
rm -r dir2-1     # 削除できる
```

ディレクトリを削除したい場合，`rm -r`の代わりに`rmdir`コマンドを使うことを推奨する．`rmdir`は空のディレクトリを削除するコマンドである．Linuxでは一度削除したファイルやディレクトリを復旧できない(Windowsのようなゴミ箱はない)．間違ったディレクトリを消さないためにも`rmdir`コマンドを使うとよい．

書式

```bash
rmdir [オプション] <ディレクトリ名>
```

オプション

- `-p` : 指定した階層までのディレクトリを一括で削除する．ただし削除対象は空である必要がある

### ファイルの内容を表示する

ファイルの内容を表示する方法はいくつかある．

`cat`はファイルの内容をすべて表示する．

書式

```bash
cat [オプション] <ファイル名>
```

オプション

- `-n` : 行番号も合わせて表示する

例

```bash
cd ~/chapter5
printf "%s\n" {a..z} > alphabets    # 下準備
cat -n alphabets
```

`head`や`tail`コマンドは先頭または末尾の数行を表示する．

書式

```bash
head [オプション] <ファイル名>
tail [オプション] <ファイル名>
```

オプション

- `-n 数字` : 先頭または末尾から指定した数字分の行を出力する
- `-f` : (`tail`のみ)ファイルの変更をリアルタイムでモニターする

例

```bash
cd ~/chapter5
head -n 5 alphabets
tail -n 3 alphabets
```

### ファイルを検索する

ファイルがどのディレクトリに存在するか検索できる．

書式

```bash
find <パス> -name <ファイル名>
```

例

```bash
find ~ -name file1
```

### コマンドのパスを検索する

コマンドの実体はプログラムである．プログラムもファイルの一種であり，プログラム用のディレクトリに配置されている(もちろん自分で好きな場所に配置することも可能)．しかし，基本的なコマンドを実行する時，そのプログラムがどのディレクトリに属するかを意識する必要はない．`PATH`という環境変数にプログラムが配置されているディレクトリを設定しているからである．インターネットでプログラミング言語などをインストールしたときに「パスを通す」と書かれているのはこのことである．

書式

```bash
which <コマンド名>
```

例

```bash
which ls
which cat
```

また，`PATH`環境変数に含まれているディレクトリは以下のコマンドで確認できる．

```bash
echo $PATH
```

## 5.3 パーミッション

Linuxではファイルやディレクトリに関する権限(permission)が重要な役割を果たす．これにはファイルの読み取り，書き込み，実行の権限が含まれる．これらのパーミッションは所有者(owner)，グループ(group)，その他のユーザ(other)の3つのカテゴリに分けられる．権限は読み取り(r)，書き込み(w)，実行(x)の3つからなる．

ファイルのパーミッションや所有者，グループなどを確認する方法として`ls -l`がある．

例えば，以下のような結果が得られる．

```
$ ls -l /bin/ls
-rwxr-xr-x  1 root  wheel 187120  12 31 2020  /bin/ls
```

この結果の見方を説明する．ファイルのパーミッションは`rwxr-xr-x`で表され，その後の`root`や`wheel`が所有者，グループを表す(先頭の`-`はファイルかディレクトリかの指標)．

この`rwxr-xr-x`パーミッションは以下のような意味である．

|  | 読み込み | 書き込み | 実行 |
| --- | --- | --- | --- |
| 所有者(root) | ◯ | ◯ | ◯ |
| グループ(wheel) | ◯ | × | ◯ |
| その他のユーザ | ◯ | × | ◯ |

パーミッションの変更には`chmod`コマンドを用いる．

```bash
chmod <設定方法> <ファイル名>
```

設定方法にはシンボルモードと数値モードがある．

- シンボルモード: `u+x`のように文字で表す
    - `[ugoa][+-=][rwx]`で書く(誰に，どうする，何の権限を)
    - `[ugoa]` : 所有者，グループ，その他，全員に対して
    - `[+-=]` : 権限を付与する，禁止する，指定した権限と等しくする
    - `[rwx]` : 読み込み，書き込み，実行権限を
- 数値モード: `755`のように8進数の3桁の数値で表す
    - 1番大きい桁が所有者，次にグループ，最後がその他の権限を示す
    - 各桁は8進数であり，4(読み込み)+2(書き込み)+1(実行)の有無で表される
    - 例えば`7`ならすべての権限があり，`5`(4+1)では読み込みと実行権限がある

ファイルの所有者やグループを変えたい時は`chown`や`chgrp`コマンドを使う．

```bash
chown <ユーザ名> <ファイル・ディレクトリ名>
chgrp <グループ名> <ファイル・ディレクトリ名>
chown <ユーザ名>:<グループ名> <ファイル・ディレクトリ名>   # 同時に変更
```

## 5.4 アーカイブと圧縮

プログラムなどを作成している時，多くのファイルを扱うが，アーカイブと圧縮は非常に重要である．これらの機能を使うことでファイルやディレクトリを効率的に保存，転送，バックアップできる．

アーカイブは複数のファイルやディレクトリを1つのファイルにまとめることを指す．圧縮はファイルのサイズを小さくすることである．この2つの作業を行い，複数のファイルを1つにまとめてからそのサイズを小さくするのが一般的である．

以下，Linuxでよく使われるアーカイブと圧縮のコマンドをいくつか紹介する．

ファイルを圧縮したい時は`gzip`コマンドを使う．

```bash
gzip <ファイル名>    # <ファイル名>.gzというファイルが出力される
```

ディレクトリを圧縮したい時は`tar`コマンドでアーカイブファイルを作ってから`gzip`を使う．多くの場合，`tar`コマンドのオプションをつけて1行で処理する．

```bash
tar zcvf <作成するファイル名> <対象のファイル・ディレクトリ名>
```

- `z` : gzip方式を指定
- `c` : 新しくアーカイブファイルを作成する
- `x` : 圧縮ファイルからファイルを取り出す
- `v` : 圧縮・展開するファイル名を表示する
- `f` : アーカイブファイル名を指定する

圧縮されたファイルを展開する時は下記のコマンドを用いる．

```bash
tar zxvf <展開したいファイル名>
```

## 5.5 ファイルの転送

異なるコンピュータ間でのファイルのやり取り方法はいくつかある．最近はクラウド機能を活用してファイルのやり取りをすることも多いが，コマンドでファイルを転送することもできる．ファイル転送には複数の通信方式がある．ここでは基本的な通信方式を紹介する．実際に異なるコンピュータ間で通信する場合は，それぞれの環境・用途に合わせて選択する．

- FTP(File Transfer Protocol): FTPはネットワークを通じてファイルを転送する最初のプロトコルである．暗号化されていないので注意が必要である．
- SCP(Secure Copy): SCPはSSH(Secure Shell)プロトコルを使い暗号化されたネットワーク接続でファイルを転送する．Unix/Linux間でのみ使用できるが高速である．

SCPコマンドは以下のように使用する．

書式

```bash
scp [オプション] <コピー元パス> <コピー先パス>
```

オプション

- `-i` : 鍵ファイルを指定する
- `-p` : ポート番号を指定する
- `-r` : ディレクトリごと再帰的にコピーする

パスの指定方法

```bash
<ユーザ名>@<サーバのホスト名>:<パス>
```

ローカルPCの場合，`<ユーザ名>@<サーバのホスト名>:`は省略できる．

## 補足 文字コード

文字コードはコンピュータが文字を識別，表示，処理するための一連の規則である．すべての文字や記号(絵文字)はユニークな数値コードにマッピングされる．最もよく知られている文字コードにはASCII(American Standard Code for Information Interchange)，Unicode，Shift-JISなどがある．日本語を使用する環境ではUnicodeの一つであるUTF-8やShift-JISがよく使われる．文字コードはテキストファイルを作成，読み取り，編集する際に特に重要であり，間違った文字コードを使うとテキストが正しく表示されない，いわゆる文字化けが発生する．ファイルを開いて文字化けが発生した場合はファイルを開くアプリの文字コード設定を見直すとよい．

## 補足 バイナリ

バイナリは2進数を指す言葉である．コンピュータ内部ではすべてのデータが0と1のバイナリ形式で扱われる．特にバイナリファイルはテキストファイルとは異なり，コンピュータが読むことに特化しており，人間が直接読むことを意図していないファイルである．実行可能ファイル，画像ファイル，音声ファイルなどがこれに該当する．例えばVimで画像ファイルを読み込むと内容が判別できない画面が表示される．バイナリ形式のファイルは特殊なソフトウェアなしには読み取ることができず，また間違った操作をするとデータの破損の原因となるため注意が必要である．