# Chapter09 正規表現

正規表現とは、様々な文字列を1つの文字列で表現する方法です。つまり、文字のパターンを記述することになります。文字のパターンとは、例えば、数字で始まる文字列や、aから始まりbで終わる任意の長さの文字列などです。正規表現は、検索や置換で非常に効果を発揮します。特にデータ分析におけるテキストデータの前処理をする際に非常に役立ちます。

ここでは、基本的な正規表現を教えることにし、さらに深く学びたい方はご自身で勉強してみて下さい。

## 9.1 メタ文字

文字列のパターンを作るためには、一つの文字で複数の意味を表す文字が必要になります。そこでメタ文字が使われます。メタ文字とは、特殊な意味や機能を持つ文字のことです。

| メタ文字 | 読み方 | 説明 | 使用例 | 使用例の説明 |
| --- | --- | --- | --- | --- |
| `.`  | ピリオド | 任意の1文字 | `a.c`  | “a”の後に任意の1文字が来てから”c”が来る文字列にマッチします。 |
| `^` | キャレット | 行の先頭 | `^Start`  | 文字列の先頭が”Start”で始まる場合にマッチします。 |
| `$` | ダラー | 行の末尾 | `end$` | 文字列の末尾が”end”で終わる場合にマッチします。 |
| `*` | アスタリスク | 直前の要素が0回以上繰り返される | `go*gle`  | “g”の後に0回以上の”o”が続いた後に”gle”が来る文字列にマッチします。例えば、“google”や”ggle”にマッチします。 |
| `+` | プラス | 直前の要素が1回以上繰り返される | `go+gle`  | “g”の後に1回以上の”o”が続いた後に”gle”が来る文字列にマッチします。例えば、“google”にはマッチしますが、“gle”や”gggle”にはマッチしません。 |
| `?` | クエスチョン | 直前の要素が0回または1回以上繰り返される | `colou?r` | “colour”または”color”という文字列にマッチします。 |
| `[]`  | 角括弧 | 文字の集合． `-` を使うことで範囲を表すことができる． | `[aiueo]` 
`[0-9]`
`[a-z]` | a, i, u, e, oのいずれかの文字にマッチします。 |
| `{}` | 中括弧 | 繰り返し回数を指定 | `[0-9]{3}` | 3桁の数字にマッチします。 |
| `()` | 丸括弧 | グループ化 | `(go)+`  | “go”という文字列が1回以上繰り返される文字列にマッチします。 |
| `|` | パイプ | 和集合を表す | `(apple|orange)` | “apple”または”orange”という文字列にマッチします。 |
| `\` | バックスラッシュ | 特殊文字のエスケープまたは特殊シーケンスの指定 | `\.`  | ピリオド (.) 自体にマッチします。 |

## 9.2 特殊文字

`\` を使うことで特殊文字とすることができます．

| 記号 | 意味 |
| --- | --- |
| `\d` | 0-9の数字 |
| `\D` | 数字以外の文字 |
| `\s` | 空白文字，タブ，改行 |
| `\S` | 空白文字以外の文字 |
| `\w` | アルファベット，数字，_ (アンダースコア) |
| `\W` | アルファベット，数字，_ |
| `\n`  | 改行 |

## 9.3 正規表現のチェック方法

自分が書いた正規表現が分からなくなったり，人が書いた正規表現が意味不明なこともあると思います．そういう時に正規表現を可視化できるサイトがありますので，紹介します．

https://regexper.com/#

このサイトは，正規表現を可視化してくれます．

[正規表現チェッカー | WEB ARCH LABO (oscasierra.net)](https://weblabo.oscasierra.net/tools/regex/)

このサイトは実際に正規表現と文字列を書いて確かめることができるサイトです．

例えばメールアドレス (foo_bar@example.com) をチェックする正規表現を考えた場合，下記になるようです ([メールアドレスの正規表現 | 正規表現入門 (javadrive.jp)](https://www.javadrive.jp/regex-basic/sample/index13.html) )．

```bash
^[a-zA-Z0-9_+-]+(.[a-zA-Z0-9_+-]+)*@([a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9]*\.)+[a-zA-Z]{2,}$
```

ただし，これだけみてもよく分からないですが，上記の正規表現可視化サイトを見ることでイメージを掴むことができます．

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/b1cb2bc0-1e3f-4944-95a7-e2023b1618bc/5a2c62da-3aa9-4eea-8c05-234869e5265f/image.png)

## 9.4 正規表現に慣れよう

正規表現に関するクイズを5問出しますので，一度考えてみてください．

問題

1. aから始まり，eで終わる，単語を正規表現で表してください．
2. aから始まり，eで終わる，5文字の単語を正規表現で表してください．
3. 日本の郵便番号 (3桁の数字，ハイフン，4桁の数字+ 例 123-4567) の形式を正規表現で表してください．
4. アメリカ英語では”or”と綴る単語は，イギリス英語では”our”となることもあります．どちらの英語でもfavoriteという意味を持つ単語を表す正規表現を考えてください．
5. ○○山という単語をアルファベット表記した時，”san”，”zan”，”yama” があります．これらを表す正規表現を考えて下さい．ただし，山という一文字はないとしてください．

答え

1. `^a.*e$`
2. `^a.{3}e$`
3. `[0-9]{3}-[0-9]{4}`  もしくは `\d{3}-\d{4}`
4. `favou?rite` 
5. `.+(san|zan|yama)$`