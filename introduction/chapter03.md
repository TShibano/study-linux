# Chapter03 シェルを使う

本章では，OS (Linuxカーネル) とユーザを繋ぐシェルについて紹介し，実際にコマンドを入力し，Linuxで処理を実行してもらいます．3.1では，カーネルとシェルの役割について説明します．3.2では，実際にシェルに触ってもらいます．3.3では，これから実際に操作をしていくシェルでの作業効率苦を高めるための便利機能について簡単に紹介します．

早くコマンドを打ちたい方もいると思いますので，先に簡単なコマンドを入力してみましょう．まず，Linux環境にログインしてください．もしGUI環境でログインした場合，アプリケーション一覧から端末 (ターミナル) を開いてください．

先頭に`xxxxx$` のような文字が表示されていると思いますが， `$` 記号の後ろに， `whoami` と入力して下さい．下記のような画面になると思います．

```
$ whoami    # $は初めから入力されていると思います．
penguin  (<- 左の文字は各個人の環境によって変化します．)
```

`whoami` は，今操作しているユーザを表示してくれます．

今後Linuxを操作するときは，今回のようにコマンドを使って操作していきます．

## 3.1 Linuxカーネルとシェル

実際にコマンドを打ってコマンドが実行されて結果が得られましたが，この時Linuxがどうのような処理をしているかを簡単に説明します．

Linuxは次のような順番で処理をしています．

1. キーボードから入力された， `whoami` という文字列を受け取る
2. `whoami` という名前のコマンドを探す
3. 見つかったコマンドを実行する
4. 実行結果を画面に出力する

このうち，3のコマンドを実行する部分は，Linuxの本体である**Linuxカーネル**が行います．

カーネルは，OSの中核となる部分で，ハードウェア (e.g. CPU，メモリ) の管理やコマンド実行を処理するプロセス管理を行います．

そして，カーネルと我々ユーザを橋渡しするのがシェルです．シェルはカーネルのインターフェースとなっています．シェルはユーザが入力したコマンドを受け取って，コマンドを探し出し，コマンドを実行するようにLinuxカーネルに依頼します．その後，Linuxカーネルがコマンドの実行を終了すると，シェルはその結果を受け取ってユーザ画面に出力します．

カーネルとShellが分離されている主な理由には下記があります．

- Shellだけを自分好みのものにカスタマイズすることが出来る．
- Linux以外のOSを理容する際も，Shellが移植されていれば同様の操作を行うことが出来る．
- Shellがクラッシュしたとしても，カーネルへの影響を最小限に抑えることが出来る．

## 3.2 Shellを触る

では，実際にコマンドを打ち込んでみましょう．

```bash
date
```

このコマンドは現在の日時を表示します．

```bash
ls
```

このコマンドは現在のディレクトリに存在するファイル・ディレクトリを表示します．

```bash
echo $SHELL
```

このコマンドは環境変数 `$SHELL` の値を表示します．つまり，現在のShellのパスを表示します．

次は少し複雑なコマンドを打ってみましょう

```bash
ps aux | grep $(whoami)
```

これはシェルの機能を組み合わせて，「現在実行中のプロセスの内，このコマンドを実行しているユーザが実行しているプロセス一覧を表示する」というコマンドを1行で書いています．このコマンドを説明すると．

1. `ps aux` で現在実行中のプロセスを表示します．
2. `|` (パイプ) を用いて，前の実行結果を次のコマンドに渡します．
3. `grep` で与えられた文字列 `$(whoami)` = 実行ユーザ名 を含む行を抽出します．
    1. `$(whoami)` には，このコマンドを実行しているユーザ名前を表示する

今すぐこの内容を理解するのは難しいと思いますが，この資料を一通り勉強すると意味がわかるようになります．

## 3.3 シェルの便利機能

これからキーボードでコマンドを入力してシェルで様々なコマンドを実行します．そこでコマンドを実行する上での便利機能を紹介します

### コントロールキーを用いた操作

ほとんどのシェルではマウスを使うことはできません．また，矢印キーも実は不要です(もちろん使うこともできます)．`C-f` とはComtrolキーを押しながらfキーを押すことです。

| キー入力 | 意味 |
| --- | --- |
| `C-f` | 1文字前方に移動する |
| `C-b` | 1文字後方に移動する |
| `C-a` | 行頭に移動する |
| `C-e`  | 行末に移動する |
| `C-h`  | カーソル位置の後方1文字を削除する
Backspaceキーと同じ |
| `C-d`  | カーソル位置の前方1文字を削除する
Deleteキーと同じ |
| `C-k` | カーソル位置から行末まで削除する |
| `C-u`  | カーソル位置から行頭まで削除する |
|  |  |

### 補完機能

シェルには補完機能が備わってます．途中までコマンドを入力して， Tabキー を押すことで候補がいくつか出てきて， Enterキー を押すことで決定することができます．補完機能を使うことで，間違えずにコマンドを打つことができるため，積極的に活用していきましょう．

```bash
ech   # ここでタブキーを押す
echo # echo と補完される
```

### コマンド履歴

過去に利用したコマンドを再度利用したい時，履歴を使うことができます， `C-p` もしくは上矢印キーを押すことでコマンド直前のコマンド履歴を出すことができます．また， `C-r` を押すことで，「インクリメンタル検索」という特殊な検索モードになります．このモードでは1文字入力するごとに履歴を検索してくれます．

### トラブル時

何らかのコマンドを実行してシェルからの応答がなくなった時， `C-c` を押すことでを強制終了することができます，

## 補足: ターミナルとシェル

ターミナルとシェルは明確に区別されます。ターミナルはユーザーがテキストベースの入力と出力を行うためのインターフェースを提供します。一方、シェルはユーザーからのコマンドを受け取り、カーネルに命令を送る役割を果たします。つまり、ターミナルはユーザーとコンピューターとの間のコミュニケーションチャネルであり、シェルはそのコミュニケーションを解釈し、適切な操作を行う役割を持っています。