# Chapter08 vi/Vim

vi/Vimは、多くのLinuxディストリビューションで、デフォルトでインストールされており、テキストファイルを編集するエディタとして多くのユーザに使われています。マウスや矢印キーを使わないという点で非常に独特ですが、使い慣れると非常に高速にファイルを編集することができるようになります。初めて使う場合は非常に戸惑いますので、基本的な使い方を紹介します。ご興味ある方はさらに勉強してみると良いでしょう。8.1ではviとVimの違いを紹介します．8.2では，Vimのモードとコマンドを紹介します．8.3ではVimチュートリアルを実際に行ってもらいます．

## 8.1 viとVim

現在のLinuxでは、viが使われていることは少なく、Vimが使われていることがほとんどです。viは環境非依存で特に設定せずに用いることがほとんどです。しかしそれでは作業効率を高めることが出来ません。そこで、viに対して様々な機能を付加した、Vim (vi improved)が使われています。Vimはカスタマイズ性が非常に高く、ユーザが自身の好みに合わせてVimを徹底的に改良することが出来ます。本資料ではVimを用いて説明します。多くの部分でviと共通ですが、一部はVimにしかない機能もあるのでviを知りたい場合ご注意下さい。

Vimのバージョン等を確認します。

```bash
which vim    # vimのパスを表示する

vim --version    # vimのバージョンを確認する
```

Vimは以下のコマンドで実行できます。

```bash
vi     # Vimを開く

vi <file>     # ファイルを指定してVimを開く．
```

## 8.2 Vimのモードと基本的なコマンド

Vimには特に重要な4つのモードがあります。それ以外もありますが、まずはこの4つを理解することで、Vimに対する理解が深まります。Vimはモードごとにキー割当が変化します。この機能により、キーボードのみで全ての編集機能があります。始めのうちは現在のモードが分からなくなります。その時、ESCキーを2回押すとノーマルモードに戻ることができます。

- ノーマルモード
    - カーソル移動やテキストの削除、コピー、ペーストなどの簡単な指示を行う。
- ビジュアルモード
    - テキストを選択するだけのモード。
- インサートモード
    - 実際にテキストを入力するモード。
- コマンドラインモード
    - ファイルを開いたり、検索・置換などの様々な指示を行う。

図にするとこのような関係になっています．

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/b1cb2bc0-1e3f-4944-95a7-e2023b1618bc/3a849064-a2f4-4668-8cff-7dde5bfd1370/Untitled.png)

図. Vimの基本的なモードの関係図

引用: [はじめてのVim 〜 Vimはいいぞ！ゴリラと学ぶVim講座(1) | さくらのナレッジ (sakura.ad.jp)](https://knowledge.sakura.ad.jp/21687/)

ここからは各モードでよく使われるものを紹介していきます．

その前にキー入力の記述方法を紹介します．

`x` と書かれた場合，小文字の “x” を表します．

`X` と書かれた場合，大文字の ”X” を表します．

`C-x` と書かれた場合， `Control` キーを押しながら，小文字の “x” を押します．

`xy` と書かれた場合，小文字の “x” を押し，その後小文字の ”y” を押します．

`5x` と書かれた場合，数字の “5” を押し，その後小文字の “y” を押します．なお，数字は特に指定がない限り任意です．

### ノーマルモード

移動に関わるコマンド

| キー入力 | 意味 |
| --- | --- |
| `h` | 左に移動する． |
| `j`  | 下に移動する． |
| `k` | 上に移動する． |
| `l` | 右に移動する． |
| `C-u` | 上のページに移動する． |
| `C-d` | 下のページに移動する． |
| `gg`  | ファイルの最初の行に移動する． |
| `G` | ファイルの最後の行に移動する． |
| `0` | 今いる行の先頭に移動する． |
| `$` | 今いる行の最後に移動する． |
| `C-g` | 今カーソルがある位置を表示する． |

文字列を入力するために，ノーマルモードからインサートモードになるためのコマンド

| キー入力 | 意味 |
| --- | --- |
| `i` | カーソル位置に対してインサートモードになる． |
| `A`  | カーソル位置を行末に移動し，インサートモードになる． |
| `o` | 新しく下に行を作成し，インサートモードになる． |
| `O` (大文字のオー) | 新しく上に行を作成し，インサートモードになる． |

文字列を編集するのに用いるコマンド

| キー入力 | 意味 |
| --- | --- |
| `x`  | 文字を削除する． |
| `dd` | 行を削除する． |
| `cc` | 行を変更する． |
| `u` | 最後のコマンドを取り消す． |
| `C-r` | 取り消しを取り消す． |
| `rx`  | カーソルを合わせている文字を別の文字(`x`)に置換する． |
| `p`  | カーソルの後に貼り付ける． |
| `/word`  | `word`という単語を検索する．Enterを押した後に， `n` を打つと前方検索， `N` を打つと後方探索する． |
| `s/old/new/g`  | `old` という単語をすべて `new` に置換する． `s` の代わりに `%s` とするとファイル全体で置換する． |

### ビジュアルモード

`v` を押すとヴィジュアルモードになります．ヴィジュアルモードになった後，移動コマンドで範囲を選択することができ，その範囲に対して削除コマンドなどを実行することができます．

### インサートモード

インサートモードになると，実際に文字を入力することができます．ノーマルモードで `i`  や `o` などを押すとインサートモードになります．

### コマンドラインモード

`:` を押すとさまざまなコマンドを使用することができます．

| キー入力 | 意味 |
| --- | --- |
| `:w`  | ファイルを保存する |
| `:q`  | ファイルを閉じる |
| `:r <file>`  | カーソル位置の下に `<file>` の中身を読み込む． |

## 8.3 Vimのチュートリアル

シェル上で下記のコマンドを打つと，チュートリアルを体験することができます．チュートリアルのテキストファイルをVimで開き，実際にVimを操作することができます．実際にチュートリアルをすることでVimを実践してみてください．

```bash
vimtutor
```

## 補足 Vimのカスタマイズ

Vimには大きく2つのカスタマイズ方法があります。1つ目は `~/.vimrc` ファイルに初期設定を記述することです。2つ目はVim Scriptを使ったプラグインです。これらの方法によりVimにさまざまな機能を付与し，作業を効率化することができます．